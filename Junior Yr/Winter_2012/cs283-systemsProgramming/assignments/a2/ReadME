This is incomplete, I was only able to get filename replacement done.
